<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <context:component-scan base-package="com.ray.springxml" />

    <!-- 20241228: 使用xml开启mvc注解时，message-converters 必须通过如下方式配置，
    通过 org.springframework.web.servlet.config.annotation.WebMvcConfigurer 方法不生效，
    除非使用 @EnableWebMvc -->
    <!-- 启用Spring MVC注解驱动，同 @EnableWebMvc -->
    <mvc:annotation-driven>
        <!-- 确保请求响应的中文字符串不乱码 -->
        <mvc:message-converters>
            <bean class="org.springframework.http.converter.StringHttpMessageConverter">
                <constructor-arg value="UTF-8" />
            </bean>
        </mvc:message-converters>
    </mvc:annotation-driven>

    <!-- 数据源使用 HikariCP 连接池配置 -->
    <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource">
        <!-- 基本的数据库连接信息 -->
        <property name="driverClassName" value="com.mysql.cj.jdbc.Driver" />
        <property name="jdbcUrl" value="jdbc:mysql://my.mysql.com:3306/test" />
        <property name="username" value="root" />
        <property name="password" value="Cjj++1996" />

        <!-- 连接池大小等其他 HikariCP 配置 -->
        <property name="maximumPoolSize" value="10" /> <!-- 最大连接数 -->
        <property name="connectionTimeout" value="30000" />  <!-- 连接超时时间 -->
        <property name="idleTimeout" value="600000" />  <!-- 空闲超时 -->
        <property name="maxLifetime" value="1800000" /> <!-- 最大生命周期 -->
    </bean>

    <!-- JdbcTemplate 配置 -->
    <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <!-- UserDao 配置 -->
    <bean id="userDao" class="com.ray.enjoy.spring.mvc.xml.dao.UserDao">
        <!-- <property name="jdbcTemplate" ref="jdbcTemplate" /> -->
        <constructor-arg name="jdbcTemplate" ref="jdbcTemplate" />
    </bean>

    <bean id="userService" class="com.ray.enjoy.spring.mvc.xml.UserService">
        <constructor-arg name="userDao" ref="userDao" />
    </bean>

</beans>